<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Reading Journal â€¢ Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1c1c2b">
  <link rel="stylesheet" href="css/style.css">
  <!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">

<!-- iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Reading Journal">

<!-- Ãcones para iOS -->
<link rel="apple-touch-icon" href="icons/icon-192.png">

<!-- Splash screens iOS -->
<link rel="apple-touch-startup-image" href="screenshots/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-1668x2224.png" media="(device-width: 834px) and (device-height: 1112px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px)">
<link rel="apple-touch-startup-image" href="screenshots/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px)">

  <style>
    /* ==========================
       BODY & BACKGROUND
    ========================== */
    body {
      margin: 0;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: clamp(14px, 2vw, 16px);
      background:
        linear-gradient(rgba(32,32,117,0.75), rgba(135,135,199,0.75)),
        url("https://img.myloview.com.br/fotomurais/esboce-o-teste-padrao-ou-o-fundo-sem-emenda-dos-livros-do-vintage-esboco-livro-sem-emenda-de-educacao-para-escola-literatura-e-apple-ilustracao-700-149614705.jpg")
        no-repeat center / cover;
    }

    /* ==========================
       NAVBAR
    ========================== */
    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      height: 64px;
      background: rgba(15,15,20,0.92);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,.4);
    }
    .nav-link {
      color: #aaa;
      text-decoration: none;
      font-size: .95rem;
      padding: 8px 14px;
      border-radius: 8px;
      transition: all .25s ease;
      position: relative;
      flex-shrink: 0;
    }
    .nav-link.active {
      color: #fff;
      font-weight: 600;
      background: rgba(255,255,255,.12);
    }
    .nav-link.active::after {
      content: "";
      position: absolute;
      bottom: -6px;
      left: 50%;
      width: 18px;
      height: 3px;
      background: #7c7cff;
      border-radius: 3px;
      transform: translateX(-50%);
    }
    .nav-link:hover { color: #fff; background: rgba(255,255,255,.08); }
    .navbar::-webkit-scrollbar { display: none; }
    @media (max-width: 600px) {
      .navbar {
        justify-content: space-between;
        padding: 0 12px;
        overflow-x: auto;
        white-space: nowrap;
      }
      .nav-link { font-size: .85rem; padding: 6px 10px; }
    }

    /* ==========================
       CONTAINER
    ========================== */
    .container.challenge {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 90px;
    }

    /* ==========================
       HEADER
    ========================== */
    .challenge-header {
      width: 100%;
      max-width: 500px;
      background: #1c1c2b;
      padding: 20px;
      border-radius: 18px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      text-align: center;
    }
    .challenge-header label { font-size: 1.1rem; color: #ddd; }
    .challenge-header input {
      margin-left: 10px;
      width: 90px;
      padding: 6px 10px;
      font-size: 1rem;
      border-radius: 10px;
      border: none;
      text-align: center;
    }
    .challenge-header p { font-size: 1.2rem; margin: 0; color: #fff; }

    /* ==========================
       PROGRESS BAR
    ========================== */
    .progress-bar-container {
      width: 100%;
      max-width: 500px;
      height: 20px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #7c7cff, #c83bff);
      border-radius: 12px;
      transition: width 0.3s ease, background-position 1s linear;
      background-size: 200% 100%;
      background-position: 0% 0%;
      animation: gradientMove 3s linear infinite;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 0%; }
    }

    /* ==========================
       GRID
    ========================== */
    .challenge-grid {
      width: 100%;
      max-width: 600px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(28px, 1fr));
      gap: 10px;
      margin-bottom: 30px;
    }
    .challenge-item {
      aspect-ratio: 1 / 1;
      border-radius: 6px;
      background: #2a2a3a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #aaa;
      cursor: pointer;
      user-select: none;
      transition: transform 0.15s ease, background 0.3s ease;
    }
    .challenge-item.done { color: #000; font-weight: bold; }
    .challenge-item:active { transform: scale(1.1); }

    /* ==========================
       COLOR PICKER
    ========================== */
    .color-picker {
      margin-bottom: 40px;
      display: flex;
      justify-content: center;
    }
    .color-ball {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid #fff;
      box-shadow: 0 4px 15px rgba(255,255,255,0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .color-ball:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255,255,255,0.5);
    }
    .color-ball input[type="color"] {
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      cursor: pointer;
      opacity: 0;
    }
    .color-ball::before {
      content: "ðŸŽ¨";
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      font-size: 1.5rem;
      color: #fff;
    }

    /* ==========================
       RESET BUTTON
    ========================== */
    #resetChallenge {
      background: linear-gradient(135deg, #cd71f2, #9b77a4);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 16px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(116, 28, 28, 0.5);
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 40px;
    }
    #resetChallenge:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 6px 20px rgba(176,149,149,0.7);}
    #resetChallenge:active { transform: translateY(0) scale(0.98); box-shadow: 0 3px 10px rgba(166,118,118,0.5);}
    #resetChallenge span { display: inline-block; transition: transform 0.4s ease; }
    #resetChallenge:active span { transform: rotate(360deg); }

    .alphabet-grid {
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 20px;
}

  </style>
</head>
<body>

<nav class="navbar">
  <a href="livros.html" class="nav-link">Livros</a>
  <a href="challenge.html" class="nav-link ">Challenge</a>
  <a href="calendario.html" class="nav-link">CalendÃ¡rio</a>
  <a href="bingo.html" class="nav-link">Bingo</a>
  <a href="cores.html" class="nav-link">Cores</a>
  <a href="favoritos.html" class="nav-link">Favoritos</a>
  <a href="a-z.html" class="nav-link">A-Z</a>
</nav>

<div class="container challenge">
  <h1>ðŸ“š Book Challenge</h1>

  <div class="challenge-header">
    <label>Meta anual: <input type="number" id="goalInput" value="200" min="1"></label>
    <p><span id="doneCount">0</span> / <span id="goalCount">200</span> livros</p>
  </div>

  <div class="progress-bar-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="challenge-grid" id="challengeGrid"></div>

  <button id="resetChallenge"><span>ðŸ”„</span> Resetar progresso</button>
</div>

<div class="color-picker">
  <label class="color-ball"><input type="color" id="colorInput" value="#ffc0cb"></label>
</div>

<script>
const grid = document.getElementById("challengeGrid");
const goalInput = document.getElementById("goalInput");
const goalCount = document.getElementById("goalCount");
const doneCount = document.getElementById("doneCount");
const colorInput = document.getElementById("colorInput");
const progressBar = document.getElementById("progressBar");
const resetBtn = document.getElementById("resetChallenge");

// Inicializa variÃ¡veis
let selectedColor = colorInput.value;
let notifiedPercentages = JSON.parse(localStorage.getItem("notifiedPercentages")) || [];

// Atualiza cor selecionada
colorInput.addEventListener("input", () => selectedColor = colorInput.value);

// Renderiza grid
function renderGrid(total) {
  grid.innerHTML = "";
  goalCount.textContent = total;
  const saved = JSON.parse(localStorage.getItem("challengeProgress")) || [];

  for (let i = 1; i <= total; i++) {
    const item = document.createElement("div");
    item.className = "challenge-item";
    item.textContent = i;

    if (saved[i-1]?.done) {
      item.classList.add("done");
      item.style.backgroundColor = saved[i-1].color;
      item.textContent = saved[i-1].emoji || "ðŸ“–";
    }

    item.addEventListener("click", () => {
      item.classList.toggle("done");
      item.style.backgroundColor = item.classList.contains("done") ? selectedColor : "";
      item.textContent = item.classList.contains("done") ? "ðŸ“–" : i;

      atualizarProgressBar();
      salvarProgresso();
      checkMotivation();
    });

    grid.appendChild(item);
  }

  atualizarProgressBar();
  // Checa alertas ao renderizar (para progresso jÃ¡ salvo)
  checkMotivation();
}

// Atualiza barra
function atualizarProgressBar() {
  const totalFeitos = document.querySelectorAll(".challenge-item.done").length;
  doneCount.textContent = totalFeitos;
  const percent = (totalFeitos / Number(goalCount.textContent)) * 100;
  progressBar.style.width = percent + "%";
}

// Salva progresso
function salvarProgresso() {
  const progress = [];
  document.querySelectorAll(".challenge-item").forEach(item => {
    progress.push({
      done: item.classList.contains("done"),
      color: item.style.backgroundColor,
      emoji: isNaN(parseInt(item.textContent)) ? item.textContent : null
    });
  });
  localStorage.setItem("challengeProgress", JSON.stringify(progress));
  localStorage.setItem("notifiedPercentages", JSON.stringify(notifiedPercentages));
}

// Alertas motivacionais
function checkMotivation() {
  const totalFeitos = Number(doneCount.textContent);
  const totalMeta = Number(goalCount.textContent);
  const percent = (totalFeitos / totalMeta) * 100;

  const milestones = [
    { pct: 25, msg: "ðŸŽ‰ JÃ¡ completou 25% da meta!" },
    { pct: 50, msg: "ðŸ’ª Metade da meta concluÃ­da!" },
    { pct: 75, msg: "ðŸ”¥ Quase lÃ¡, 75%!" },
    { pct: 100, msg: "ðŸ† ParabÃ©ns! Meta alcanÃ§ada!" }
  ];

  milestones.forEach(m => {
    // Checa se ultrapassou ou igualou a porcentagem e ainda nÃ£o notificou
    if (percent >= m.pct && !notifiedPercentages.includes(m.pct)) {
      alert(m.msg);
      notifiedPercentages.push(m.pct);
      localStorage.setItem("notifiedPercentages", JSON.stringify(notifiedPercentages));
    }
  });
}

// Reset
resetBtn.addEventListener("click", () => {
  document.querySelectorAll(".challenge-item").forEach((item, i) => {
    item.classList.remove("done");
    item.style.backgroundColor = "";
    item.textContent = i + 1;
  });
  doneCount.textContent = 0;
  notifiedPercentages = [];
  localStorage.setItem("notifiedPercentages", JSON.stringify(notifiedPercentages));
  atualizarProgressBar();
  salvarProgresso();
});

// Alterar meta
goalInput.addEventListener("change", () => {
  const novaMeta = Number(goalInput.value);
  renderGrid(novaMeta);
  notifiedPercentages = []; // reset alertas para nova meta
  localStorage.setItem("notifiedPercentages", JSON.stringify(notifiedPercentages));
});

const paginaAtual = location.pathname.split("/").pop();

document.querySelectorAll(".nav-link").forEach(link => {
  const href = link.getAttribute("href");
  link.classList.toggle("active", href === paginaAtual);
});

// Inicializa grid
renderGrid(Number(goalInput.value));

</script>

</body>
</html>
